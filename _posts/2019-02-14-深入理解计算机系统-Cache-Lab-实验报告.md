---
layout: post
title: "深入理解计算机系统 Cache Lab 实验报告"
comments: true
description: "深入理解计算机系统 Cache Lab 实验报告"
keywords: "Cache Lab, 深入理解计算机系统, CSAPP"
---

## 1 下载

相关的 Handout 点击[这里](http://csapp.cs.cmu.edu/3e/labs.html)下载。

下载后将文件上传到 Linux 服务器，然后使用命令 `tar xvf cachelab-handout.tar` 解压。在解压后的诸多文件里，**csim.c** 和 **trans.c** 这两个文件是本实验涉及到修改的。

执行下面的命令可以进行编译：

```
linux> make clean
linux> make
```

## 2 介绍

这个实验将帮助你理解缓存对你的 C 程序的影响。

这个实验包括两部分。第一部分要求写一个 200 ~ 300 行的 C 程序，来模拟缓存的行为。在第二部分，你将会优化一个小的矩阵转置函数，来减少缓存不命中。

### 2.1 Reference Trace Files

解压后的文件中，**traces** 子文件夹包括一些 **reference trace files**。在 Part A 中，这些文件可以帮助你评估你代码的正确性。

这些 trace files 是由 [Valgrind](https://zh.wikipedia.org/wiki/Valgrind) 生成的。例如，输入命令：

```
linux> valgrind --log-fd=1 --tool=lackey -v --trace-mem=yes ls -l
```

来捕获执行 **ls -l** 时的每一次 **memory accesses** 。并将相关信息打印到 stdout。格式如下：

```
I 0400d7d4, 8
M 0421c7f0, 4
L 04f6b868, 8
S 7ff0005c8,8
```

```
[空格]operation address,size
```

**operation** 指明了 **memory access** 的类型：

1. **“I”** 是指令 load。
2. **“L”** 是数据 load。
3. **“S”** 是数据 store。
4. **“M”** 是数据 modify（即数据 load + 数据 store）。

**“I”** 前面是不能有空格的。其余 3 种情况通常会有空格。

**address** 指明了一个 64 bit - 16 进制的内存地址。

**size** 指明了当前 **memory access** 操作的字节数。

### 2.2 Part A：Writing a Cache Simulator




