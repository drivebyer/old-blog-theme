---
layout: post
title: "MIT6.828 操作系统 Lab1:Booting a PC"
comments: true
description: "MIT6.828 操作系统 Lab1:Booting a PC"
keywords: "Lab, 6.828, MIT"
---

# 介绍

这个实验分为 3 部分，第一部分用来熟悉 x86 汇编，QEMU 和 PC 启动过程。第二部分实操 6.828 kernel 的启动加载。第三部分，探索 6.828 kernel 的初始化。

## 软件设置

实验使用 git 版本控制系统，仓库地址为 [](https://pdos.csail.mit.edu/6.828/2018/jos.git)，使用命令将仓库 clone 到本地。

在实验开始之前需要安装 `qemu` 和 `gcc`，参考链接为[tool page](https://pdos.csail.mit.edu/6.828/2018/tools.html)。

# Part 1: PC Bootstrap

这个作业的目的是介绍 x86 汇编语言和 PC 启动过程，并熟悉 QEMU 和 QEMU/GDB 调试。

## Getting Started with x86 assembly

下面是实验中提供的一些关于汇编的资源：

1. [PC Assembly Language](https://pdos.csail.mit.edu/6.828/2018/readings/pcasm-book.pdf)
2. [Brennan's Guide to Inline Assembly](http://www.delorie.com/djgpp/doc/brennan/brennan_att_inline_djgpp.html)
3. [Intel® 64 and IA-32 Architectures Software Developer Manuals
](https://software.intel.com/en-us/articles/intel-sdm)

这三份资源，第一个是对汇编语言的入门教材，由于这个课程是用的是 GUN assembler，而不是 NASM assenbler，所以提供了第二份资料来学习 Intel 与 AT&T 汇编语法的差别。

第三份资料则是最权威的 Intel 开发手册。

## Simulating the x86

qemu 内置的 debug 功能受限，我们将换用 gdb 进行调试。

编译上面 clone 下来的仓库代码，注意前提是安装好了实验指定版本的 qemu 和 gcc。

编译完 JOS kernel 后，执行 `make qemu`，最终 qemu 窗口显示如下文本:

```c
Booting from Hard Disk...
6828 decimal is XXX octal!
entering test_backtrace 5
entering test_backtrace 4
entering test_backtrace 3
entering test_backtrace 2
entering test_backtrace 1
entering test_backtrace 0
leaving test_backtrace 0
leaving test_backtrace 1
leaving test_backtrace 2
leaving test_backtrace 3
leaving test_backtrace 4
leaving test_backtrace 5
Welcome to the JOS kernel monitor!
Type 'help' for a list of commands.
K>
```

**Booting from Hard Disk...** 后所有的输出都来自于 JOS 内核。

JOS 内核目前只有两条命令 **help** 和 **kerninfo**。

## The PC's Physical Address Space

PC 的物理地址布局通常如下:

```c
+------------------+  <- 0xFFFFFFFF (4GB)
|      32-bit      |
|  memory mapped   |
|     devices      |
|                  |
/\/\/\/\/\/\/\/\/\/\

/\/\/\/\/\/\/\/\/\/\
|                  |
|      Unused      |
|                  |
+------------------+  <- depends on amount of RAM
|                  |
|                  |
| Extended Memory  |
|                  |
|                  |
+------------------+  <- 0x00100000 (1MB)
|     BIOS ROM     |
+------------------+  <- 0x000F0000 (960KB)
|  16-bit devices, |
|  expansion ROMs  |
+------------------+  <- 0x000C0000 (768KB)
|   VGA Display    |
+------------------+  <- 0x000A0000 (640KB)
|                  |
|    Low Memory    |
|                  |
+------------------+  <- 0x00000000
```