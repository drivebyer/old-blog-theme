---
layout: post
title: "内联汇编初探"
comments: true
description: "内联汇编初探"
keywords: "inline, assembly, 内联, 汇编"
---

# Basic inline assembly

最基本的内联汇编格式如下:

```c
asm ("statements");
```

例如，asm ("cli") 将会禁止中断发生，asm ("sti") 执行后又恢复中断。如果 asm 与程序内容冲突，也可以使用 _asm_ 代替。

将一个 asm 中有多个 statements 也是可以的，像下面这样:

```c
asm ("pushl %eax\n\t"
     "movl $0, %eax\n\t"
     "popl %eax");
```

It's really meant for issuing instructions for which there is no equivalent in C and don't touch the registers.

# Extended inline assembly

还有一种允许输入输出参数的格式，如下:

```c
asm ( "statements" : output_registers : input_registers : clobbered_registers);
```

来看下面的例子:

```c
asm ("cld\n\t"
     "rep\n\t"
     "stosl"
     : /* no output registers */
     : "c" (count), "a" (fill_value), "D" (dest)
     : "%ecx", "%edi" );
```

上面的指令将 fill_vlaue * count 放进 dest 地址所在的地方。